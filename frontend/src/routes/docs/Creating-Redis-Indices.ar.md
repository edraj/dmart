# إنشاء مؤشرات روديس(Redis)

---

**مقدمة:** تم تصميم البرنامج النصي المقدم لإعادة إنشاء فهارس روديس بناءً على تعريفات المخطط المتوفرة. فهو يمر عبر ملفات نموذج البيانات (DM) المخزنة في بنية نظام ملفات معينة، ويحمل البيانات التعريفية، وينشئ أو يقوم بتحديث المؤشرات المقابلة في روديس. تتيح هذه العملية استرجاع البيانات والاستعلام عنها بكفاءة من قاعدة بيانات روديس.

**نظرة عامة على البرنامج النصي:**

- **الغرض:** إعادة إنشاء مؤشرات روديس بناءً على تعريفات المخطط.
- **اللغة:** بايثون 3.
- **التبعيات:**
  - `argparse`: لتحليل وسائط سطر الأوامر.
  - `json`: للتعامل مع بيانات JSON.
  - `re`: للتعبيرات العادية.
  - `غير متزامن`: لعمليات الإدخال/الإخراج غير المتزامنة.
  - `المعالجة المتعددة`: للمعالجة المتوازية.
  - وحدات مخصصة أخرى لعمليات قاعدة البيانات والتحقق من صحة المخطط وخدمات روديس.

**وسائط سطر الأوامر:**

- `-p, --space`: إعادة إنشاء الفهارس لمساحة معينة.
- `-c, --schemas`: إعادة إنشاء الفهارس لمخططات محددة.
- `-s, --subpaths`: تحميل المستندات لمسارات فرعية محددة فقط.
- `--flushall`: مسح جميع البيانات الموجودة في روديس قبل إعادة إنشاء الفهارس.

**مثال الاستخدام:**

bash
`./create_index.py -p products -c offer ticket -s subpath1 subpath2 --flushall`

يقوم هذا الأمر بإعادة إنشاء الفهارس لمساحة "المنتجات"، ولمخططات "العرض" و"التذكرة"، وتحميل المستندات للمسارات الفرعية "subpath1" و"subpath2"، مما يؤدي إلى مسح جميع البيانات الموجودة في روديس.

**كيف يعمل:**

1. **الوظيفة الرئيسية (`الرئيسية`):** تنظم هذه الوظيفة عملية إعادة إنشاء مؤشرات روديس. فهو يتعامل مع وسيطات سطر الأوامر، ويقوم بتهيئة خدمات روديس، وإنشاء الفهارس أو مسحها وفقًا للخيارات المتوفرة، وتحميل البيانات من نظام الملفات إلى روديس.
2. **تحميل البيانات إلى روديس (`load_data_to_redis`):** تقوم هذه الوظيفة بتحميل البيانات الوصفية وبيانات الحمولة من نظام الملفات وتخزينها في روديس. يقوم بمعالجة البيانات لكل مسار فرعي داخل مساحة وفرع، وإعداد مستندات روديس للاستعلام الفعال.
3. **إنشاء عملية روديس Docs (`generate_redis_docs_process`):** هذه الوظيفة هي أداة مساعدة للمعالجة المتوازية. يقوم بتغليف وظيفة "generate_redis_docs" لتنفيذها بشكل غير متزامن.
4. **إنشاء مستندات روديس (`generate_redis_docs`):** تنشئ هذه الوظيفة مستندات روديس لكل محدد موقع (بيانات تعريف الملف) تمت معالجتها. يقوم باستخراج البيانات الوصفية وبيانات الحمولة، والتحقق من صحة الحمولات مقابل المخططات، وإعداد المستندات للتخزين في روديس.
5. **تحميل بيانات الفهارس المخصصة (`load_custom_indices_data`):** تقوم هذه الوظيفة بتحميل بيانات الفهارس المخصصة إلى روديس. فهو يتكرر عبر مؤشرات مخصصة محددة مسبقًا ويستدعي وظيفة "load_data_to_redis" لكل فهرس.
6. **اجتياز إدخالات المسارات الفرعية (`traverse_subpaths_entries`):** تعبر هذه الوظيفة عبر المسارات الفرعية داخل مساحة وفرع، وتحميل البيانات من نظام الملفات وتخزينها في روديس. فهو يستكشف بشكل متكرر الدلائل الفرعية ويعالج البيانات للفهرسة.
7. **تحميل جميع بيانات المساحات إلى روديس (`load_all_spaces_data_to_redis`):** تقوم هذه الوظيفة بتحميل البيانات من جميع المساحات في النظام إلى روديس. يتكرر عبر المسافات، ويستدعي وظيفة "traverse_subpaths_entries" لكل مساحة، ويملأ روديس بالبيانات المفهرسة.
